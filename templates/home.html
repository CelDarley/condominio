{% extends "base.html" %}

{% block title %}Início - SegCond{% endblock %}

{% block content %}
<div class="home-container">
    <div class="welcome-section">
        <h2>Bem-vindo, {{ current_user.nome }}!</h2>
        <p class="current-date">{{ ['Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'Sábado', 'Domingo'][hoje] }}</p>
    </div>

    <div class="day-selector">
        <h3>Selecione o dia da semana:</h3>
        <div class="day-buttons">
            <button class="day-btn" data-day="0">
                <span class="day-name">Seg</span>
                <span class="day-number">2</span>
            </button>
            <button class="day-btn" data-day="1">
                <span class="day-name">Ter</span>
                <span class="day-number">3</span>
            </button>
            <button class="day-btn" data-day="2">
                <span class="day-name">Qua</span>
                <span class="day-number">4</span>
            </button>
            <button class="day-btn" data-day="3">
                <span class="day-name">Qui</span>
                <span class="day-number">5</span>
            </button>
            <button class="day-btn" data-day="4">
                <span class="day-name">Sex</span>
                <span class="day-number">6</span>
            </button>
            <button class="day-btn" data-day="5">
                <span class="day-name">Sáb</span>
                <span class="day-number">7</span>
            </button>
            <button class="day-btn" data-day="6">
                <span class="day-name">Dom</span>
                <span class="day-number">1</span>
            </button>
        </div>
    </div>

    <div class="work-posts-section">
        <h3>Postos de Trabalho para {{ ['Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'Sábado', 'Domingo'][hoje] }}</h3>
        
        {% if postos %}
            <div class="work-posts">
                {% for posto in postos %}
                <div class="work-post-card">
                    <div class="post-header">
                        <i class="fas fa-map-marker-alt"></i>
                        <h4>{{ posto.nome }}</h4>
                    </div>
                    {% if posto.descricao %}
                    <p class="post-description">{{ posto.descricao }}</p>
                    {% endif %}
                    <a href="{{ url_for('posto', posto_id=posto.id) }}" class="btn-view-post">
                        <i class="fas fa-eye"></i>
                        Ver Detalhes
                    </a>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-posts">
                <i class="fas fa-calendar-times"></i>
                <p>Nenhum posto de trabalho atribuído para {{ hoje_nome }}</p>
            </div>
        {% endif %}
    </div>

    <div class="quick-actions">
        <h3>Ações Rápidas</h3>
        <div class="action-buttons">
            <button class="action-btn" id="btn-aviso">
                <i class="fas fa-bullhorn"></i>
                <span>Enviar Aviso</span>
            </button>
            <button class="action-btn" id="btn-status">
                <i class="fas fa-info-circle"></i>
                <span>Status Atual</span>
            </button>
        </div>
    </div>
</div>

<!-- Modal para envio de avisos -->
<div id="aviso-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Enviar Aviso</h3>
            <span class="close">&times;</span>
        </div>
        <form id="aviso-form" class="aviso-form">
            <div class="form-group">
                <label for="aviso-titulo">Título:</label>
                <input type="text" id="aviso-titulo" name="titulo" required 
                       placeholder="Digite o título do aviso">
            </div>
            <div class="form-group">
                <label for="aviso-mensagem">Mensagem:</label>
                <textarea id="aviso-mensagem" name="mensagem" required 
                          placeholder="Digite a mensagem do aviso" rows="4"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-cancel">Cancelar</button>
                <button type="submit" class="btn-send">Enviar</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const hoje = {{ hoje }};
    const dayButtons = document.querySelectorAll('.day-btn');
    
    // Marcar o dia atual
    dayButtons[hoje].classList.add('active');
    
    // Event listeners para os botões de dia
    dayButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const day = this.dataset.day;
            // Aqui você pode implementar a lógica para carregar os postos do dia selecionado
            dayButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
        });
    });
    
    // Modal de aviso
    const modal = document.getElementById('aviso-modal');
    const btnAviso = document.getElementById('btn-aviso');
    const closeBtn = document.querySelector('.close');
    const btnCancel = document.querySelector('.btn-cancel');
    const avisoForm = document.getElementById('aviso-form');
    
    btnAviso.onclick = function() {
        modal.style.display = 'block';
    }
    
    closeBtn.onclick = function() {
        modal.style.display = 'none';
    }
    
    btnCancel.onclick = function() {
        modal.style.display = 'none';
    }
    
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
    
    // Envio do aviso
    avisoForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        
        fetch('/enviar_aviso', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                alert('Aviso enviado com sucesso!');
                modal.style.display = 'none';
                avisoForm.reset();
            } else {
                alert('Erro ao enviar aviso: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Erro:', error);
            alert('Erro ao enviar aviso');
        });
    });
});
</script>
{% endblock %}
